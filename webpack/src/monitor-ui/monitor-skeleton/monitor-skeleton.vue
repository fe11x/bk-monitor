<script lang="ts">
import { Vue, Component, Prop } from 'vue-property-decorator'
@Component({ name: 'MonitorSkeleton' })
export default class MonitorSkeleton extends Vue {
  // 是否显示骨架屏
  @Prop({ default: true }) loading: boolean
  // 是否启用动画
  @Prop({ default: true }) animate: boolean
  // 内容区行数 也可设置宽度的数组
  @Prop({ default: 4 }) rows: number[] | string[] | number
  // 是否需要titlie
  @Prop({ default: true }) needTitle: boolean
  // 是否需要header
  @Prop({ default: false }) needHeader: boolean

  header() {
    if (this.$slots.header) {
      return this.$slots.header
    }
  }

  content(h) {
    if (this.$slots.content) {
      return this.$slots.content
    }
    return h('div', {
      class: {
        'monitor-skeleton-content': true
      }
    }, [this.title(h), this.rowList(h)])
  }
  title(h) {
    if (this.$slots.title) {
      return this.$slots.title
    }
    return h('h3', {
      class: {
        'content-title': true,
        'title-animate': this.animate
      },
      style: {
        width: '38%'
      }
    })
  }
  rowList(h) {
    let itemList = []
    if (Array.isArray(this.rows)) {
      itemList = this.rows.map(width => this.row(h, width))
    } else {
      for (let i = 0; i < this.rows; i++) {
        itemList.push(this.row(h, '100%'))
      }
    }
    return h('ul', {
      class: {
        'content-list': true
      }
    }, itemList)
  }
  row(h, width) {
    return h('li', {
      class: {
        'content-list-item': true,
        'item-animate': this.animate
      },
      style: {
        width
      }
    })
  }
  render(h) {
    if (!this.loading) {
      return this.$slots.default
    }
    return h('div', {
      class: {
        'monitor-skeleton': true
      }
    }, [this.header(h), this.content(h)])
  }
}
</script>
<style lang="scss" scoped>
@mixin skeleton-row {
  width: 100%;
  flex: 0 0 16px;
  height: 16px;
  background: #f2f2f2;
}
@mixin skeleton-row-animate {
  background: linear-gradient(90deg,#f2f2f2 25%,#e6e6e6 37%,#f2f2f2 63%);
  background-size: 400% 100%;
  animation: monitor-skeleton-animate 1.4s ease infinite;
}

.monitor-skeleton {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;

  @keyframes monitor-skeleton-animate {
    0% {
      background-position: 100% 50%;
    }
    to {
      background-position: 0 50%;
    }
  }
  &-header {

  }
  &-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    .content-title {
      width: 38%;
      padding: 0;
      margin: 16px 0 0 0;

      @include skeleton-row();
      &.title-animate {
        @include skeleton-row-animate;
      }
    }
    .content-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0;
      margin: 24px 0 0 0;
      list-style: none;
      &>li+li {
        margin-top: 16px;
      }
      &-item {
        flex: 1;

        @include skeleton-row();
        &.item-animate {
          @include skeleton-row-animate;
        }
      }
    }
  }
}
</style>
