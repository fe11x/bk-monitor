<template>
  <panel-card :title="$t('拨测站点可用率趋势对比')" class="available-rate-chart">
    <bk-dropdown-menu
      slot="title"
      :class="['title-setting',{ 'title-disable': !series.length && !setList.length }]"
      trigger="click"
      :disabled="!setList.length"
      ref="dropdown">
      <div slot="dropdown-trigger" class="chart-dropdown">
        <svg-icon icon-name="setting" class="icon-setting" :style="{ color: !series.length && !setList.length ? '#979BA5' : '#3A84FF' }"></svg-icon>
        <span class="tag-setting"> {{ $t('展示设置') }} </span>
      </div>
      <div slot="dropdown-content" v-if="setList.length" style="margin: -6px 0;">
        <ul class="bk-dropdown-list title-setting-dropdown" @click.stop="triggerCheckedHandle">
          <li v-for="item in setList" :key="item.id" @click.stop="triggerCheckedHandle">
            <label class="bk-form-checkbox bk-checkbox-small check-label-item char-checkbox">
              <input type="checkbox"
                     class="bk-checkbox"
                     :value="item.id"
                     v-model="checkedSets">
              <i class="bk-checkbox-text">{{item.name}}</i>
            </label>
          </li>
        </ul>
        <div class="title-setting-footer" slot="dropdown-content">
          <span @click="submitHandle"> {{ $t('确定') }} </span>
          <span @click="cancelHandle"> {{ $t('取消') }} </span>
        </div>
      </div>
    </bk-dropdown-menu>
    <monitor-echart
      unit="%"
      height="300"
      :set-no-data="false"
      :options="newOptions"
      :series="newSeries"
      :colors="['#27C24C', '#058DC7', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4', '#CAE1FF', '#CDCDB4', '#FE0000', '#C3017C']">
    </monitor-echart>
  </panel-card>
</template>

<script>
import PanelCard from '../components/panel-card/panel-card'
import MonitorEchart from '../../../../monitor-ui/monitor-echarts/monitor-echarts'
export default {
  name: 'available-rate-chart',
  components: {
    MonitorEchart,
    PanelCard
  },
  props: {
    setList: {
      type: Array,
      required: true
    },
    checkedList: {
      type: Array,
      default() {
        return []
      }
    },
    series: {
      type: Array,
      required: true
    },
    utcoffset: {
      type: Number,
      required: true
    }
  },
  data() {
    return {
      checkedSets: []
    }
  },
  computed: {
    newOptions() {
      return {
        yAxis: {
          axisLine: {
            show: true
          },
          z: 6
        },
        xAxis: {
          splitLine: {
            show: true,
            lineStyle: {
              color: '#DCDEE5',
              type: 'dashed'
            }
          },
          axisLine: {
            show: true
          },
          z: 6
        }
      }
    },
    newSeries() {
      const markArea = {
        silent: true,
        show: true,
        itemStyle: {
          color: 'rgba(255,246,242,.5)',
          borderWidth: 1,
          borderColor: 'rgba(255,246,242,.5)',
          shadowColor: 'rgba(255,246,242,.5)',
          shadowBlur: 0
        },
        data: [[{
          xAxis: 'min',
          yAxis: 0
        }, {
          xAxis: 'max',
          yAxis: 80 // this.delegateGet('getModel').getComponent('yAxis').axis.scale._extent[1]
        }]],
        opacity: 0.1
      }
      return this.series && this.series.length ? this.series.map(item => ({
        ...item,
        markArea
      })) : [{
        data: [[null, 0], [null, 100]],
        markArea
      }]
    }
  },
  watch: {
    checkedList: {
      handler(val) {
        this.checkedSets = val
      }
    }
  },
  created() {
    this.checkedSets = this.checkedList
  },
  methods: {
    cancelHandle() {
      this.$refs.dropdown.hide()
      this.checkedSets = this.checkedList
    },
    submitHandle() {
      this.$emit('update', this.checkedSets)
      this.$refs.dropdown.hide()
    },
    triggerCheckedHandle() {
      // e.stopPropagation()
    }
  }
}
</script>

<style scoped lang="scss">
    @import "../common/mixins";

    .available-rate-chart {
      .title {
        &-setting {
          float: right;
          font-size: $fontSmSize;
          color: #3a84ff;
          width: 250px;
          text-align: right;
          .chart-dropdown {
            display: flex;
            align-items: center;
            justify-content: flex-end;
          }
          .icon-setting {
            vertical-align: middle;
            width: 16px;
            height: 16px;
            color: #3a84ff;
            margin-right: 5px;
          }
          .tag-setting {
            @include hover();
          }
          &-dropdown {
            text-align: left;
            max-height: 250px;
            max-width: 250px;
            overflow: auto;
            li {
              padding: 0px 10px;
              text-overflow: ellipsis;
              overflow: hidden;
              white-space: nowrap;
              .check-label-item {
                margin: 5px;
                min-width: 100%;

                @include hover();
                .bk-checkbox-text {
                  font-style: normal;
                }
              }
              .bk-checkbox {
                cursor: pointer;
              }
              &:hover {
                background: #eaf3ff;
                cursor: pointer;
              }
            }
          }
          &-footer {
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid $defaultBorderColor;
            :nth-child(2) {
              border-left: 1px solid $defaultBorderColor;
              background: #fafbfd;
            }
            span {
              flex: 1;
              text-align: center;
              height: 30px;
              line-height: 30px;

              @include hover();
            }
          }
        }
        &-disable {
          color: #979ba5;

          @include hover(not-allowed);
          .tag-setting {
            @include hover(not-allowed);
          }
        }
      }
    }
</style>
